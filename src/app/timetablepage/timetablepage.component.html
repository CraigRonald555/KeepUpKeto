<div class="container" style="background: white">

  <div class="row">

    <div class="col-6 col-sm-6" style="padding-left: 30px">

      <h4>My Meal Plan</h4>

      <div class="row">

        <div class="profilepic" style="height: 150px"></div>

        <!-- <div class="col-md-12" style='border-left: 2px solid #bac9ff'>
          <h6>Eaten</h6>
          <p><img src='assets/img/eat.png' /> 300 kcal</p>
        </div>

      </div>

      <div class="mt-2"></div>

      <div class="row">

        <div class="col-md-12" style='border-left: 2px solid #ffb9ce'>
          <h6>Burned</h6>
          <p><img src='assets/img/burn.png' /> 200 kcal</p>
        </div> -->

      </div>

    </div>

    <div class="col-6 col-sm-6 text-center">

      <!-- <img src="assets/img/calory_circle.png" width=230 height=230> -->

    </div>

  </div>

  <div class="row">

    <div class="col-3 col-sm-3">
      <h6>Carbs</h6>
      <div class="progress p1">
        <div class="progress-bar " role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="10" [style.width]="progressBars.carbsPercentage + '%'"></div>
      </div>
      <p>{{progressBars.carbsRemaining}}g left</p>
    </div>

    <div class="col-3 col-sm-3">
      <h6>Protein</h6>
      <div class="progress p2">
        <div class="progress-bar" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="10" [style.width]="progressBars.proteinPercentage + '%'"></div>
      </div>
      <p>{{progressBars.proteinRemaining}}g left</p>
    </div>

    <div class="col-3 col-sm-3">
      <h6>Fat</h6>
      <div class="progress p3">
        <div class="progress-bar" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="10" [style.width]="progressBars.fatPercentage + '%'"></div>
      </div>
      <p>{{progressBars.fatRemaining}}g left</p>
    </div>

    <div class="col-3 col-sm-3">
      <h6>Calories</h6>
      <div class="progress p4">
        <div class="progress-bar" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="10" [style.width]="progressBars.caloriesPercentage + '%'"></div>
      </div>
      <p>{{progressBars.caloriesRemaining}}g left</p>
    </div>

  </div>

</div>

<div class="container">
  <div class="row">
    <div class="dropdown">
      <div class="mt-5"></div>
      <div class="text-center">More info</div>
    </div>
  </div>
</div>

<div class="container" style="background: #f3f5f9; padding-bottom: 100px;">

  <div class="row">

    <div class="col-6 col-sm-6">
      <h3>{{this.timetableService.getTodayName()}}</h3>
      <div class="clickable" data-toggle="modal" data-target="#exampleModal" (click)='selectedDayIndex = this.timetableService.getDayIndexByName(this.timetableService.getTodayName())'>
        Add recipe to today
      </div>
    </div>

    <div class="col-6 col-sm-6 text-right">
      <a routerLink="/timetable/weekly">
        <h3>Plan your week <span class='material-icons'>arrow_forward_ios</span></h3>
      </a>
    </div>

  </div>

  <div class="mb-5"></div>

  <owl-carousel [options]="mySlideOptions" [items]="myCarouselItems" [carouselClasses]="['owl-carousel', 'owl-theme']" #owlElement>
    <div class="item" *ngFor="let item of mySlideItems;let i = index">
      <div [class]="item.recipeTypeHTML" (dblclick)="navigateToRecipe(item.recipeID)">
        <div class="row">
            <div class="col-12">

              <div class="clickable" style='position: fixed; right: 20px; ' (click)="this.timetableService.removeRecipeByObject(this.todayRecipes, i);">
                <i class="material-icons" style="color: white">close</i>
              </div>
              <img src="./assets/img/{{item.recipeTypeHTML}}_main.png" alt="" class="inner_img">
              <div class="inner_text">
                <h3>{{item.recipeType}}</h3>
                <h4>{{item.name}}</h4>
                <h4>{{item.calories}} kcal</h4>
              </div>
            </div>

        </div>
      </div>

    </div>
   </owl-carousel>

</div>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="exampleModalLabel" *ngIf="addRecipeButtonsContentSwitch === 'buttons'">Select from the options below</div>

        <button type="button" class="btn btn-default btn-round" (click)="addRecipeButtonsContentSwitch = 'buttons'" *ngIf="addRecipeButtonsContentSwitch === 'content'">
          <i class="material-icons">keyboard_arrow_left</i>Back
        </button>

        <button #closeMainModal type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="addRecipeButtonsContentSwitch = 'buttons'; showHelp = false">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <ng-container class='fade' *ngIf="addRecipeButtonsContentSwitch === 'buttons'">

          <button (click)='retrieveRemainingNutrients()' type="button" class='btn btn-default addFoodBlock' (click)="addRecipeButtonsContentSwitch = 'content'; addRecipeOption = 0; showHelp = false">Search for Recipes</button>
          <button type="button" class='btn btn-default addFoodBlock' (click)="addRecipeButtonsContentSwitch = 'content'; addRecipeOption = 1; showHelp = false">Search for Specific Food</button>
          <!-- <button type="button" class='btn btn-default addFoodBlock' (click)="addRecipeButtonsContentSwitch = 'content'; addRecipeOption = 2; showHelp = false">Add a Custom Recipe</button> -->
          <button type="button" class='btn btn-default addFoodBlock' (click)="addRecipeButtonsContentSwitch = 'content'; addRecipeOption = 3; showHelp = false">Add from my Favourites</button>
          <br/>
          <p class='clickableText' (click)='showHelp = !showHelp'>Not sure which option to click?</p>
          <div class='help' *ngIf='showHelp'>
            <p><b>Search for Recipes</b> - Find recipes for your recipe plan, search for recipes from our database based on ingredients, time to cook, and more.</p>
            <p><b>Search for Specific Food</b> - Find specific, more individual foods which aren't included in recipes, for example, add those tasty dark chocolate treats which don't appear in the recipes</p>
            <!-- <p><b>Add a Custom Recipe</b> - Have your own recipe you'd like to add to your recipe plan? This option will allow you to add it</p> -->
            <p><b>Add from my Favourites</b> - Already have recipes saved in your favourite list? Retrieve them here and add them to your recipe plan</p>
          </div>

        </ng-container>

        <ng-container class='fade' (click)="addRecipeButtonsContentSwitch = 'buttons'" *ngIf="addRecipeButtonsContentSwitch === 'content'">

          <ng-container *ngIf="addRecipeOption === 0">

            <form #searchForRecipesForm='ngForm' ngNativeValidate>

              <div class="row">

                <div class="input-group">
                  <div class="input-group-prepend" style='padding-right:10px;'>
                    <select name="recipeType" id="recipeType" class="browser-default custom-select mb-3" [(ngModel)]="selectedRecipeType">
                      <option *ngFor="let type of recipeTypes" [ngValue]="type">{{type}}</option>
                    </select>
                  </div>
                  <input type="text" name="ingredient" id="ingredient" placeholder='Ingredient...' class="form-control" ngModel #ingredient='ngModel' minlength='1' required>
                </div>

              </div>

              <p class='clickableText' (click)='searchForRecipesAdvanced = !searchForRecipesAdvanced'>More options</p>

              <div class='advanced' [hidden]='!searchForRecipesAdvanced'>

                <div class="row">

                  <div class="form-group col-md-4">
                    <label for="weight">Calories</label>
                    <div class="input-group">
                      <input type="number" step=any name="calories" id="calories" [(ngModel)]="this.remainingNutrients.caloriesRemaining" [value]="this.remainingNutrients.caloriesRemaining" class="form-control" ngModel #calories='ngModel' minlength='1' required [readonly]=useRecommended>
                      <!-- <span class="help-block" *ngIf='(!calories.valid || calories.value.length === 0) && calories.touched'>
                        Please make sure you enter in your weight in pounds
                      </span> -->
                    </div>
                  </div>

                  <div class="form-group col-md-4">
                    <label for="weight">Carbs</label>
                    <div class="input-group">
                      <input type="number" step=any name="carbs" id="carbs" [(ngModel)]="this.remainingNutrients.carbsRemaining" [value]="this.remainingNutrients.carbsRemaining" class="form-control" ngModel #carbs='ngModel' minlength='1' required [readonly]=useRecommended>
                      <!-- <span class="help-block" *ngIf='(!modelKilograms.valid || modelKilograms.value.length === 0) && modelKilograms.touched'>
                        Please make sure you enter in your weight in kilograms
                      </span> -->
                    </div>
                  </div>

                  <div class="form-group col-md-4">
                    <label for="fat">Fat</label>
                    <div class="input-group">
                      <input type="number" step=any name="fat" id="fat" [(ngModel)]="this.remainingNutrients.fatRemaining" [value]="this.remainingNutrients.fatRemaining" class="form-control" ngModel #fat='ngModel' minlength='1' required [readonly]=useRecommended>
                      <!-- <span class="help-block" *ngIf='(!modelKilograms.valid || modelKilograms.value.length === 0) && modelKilograms.touched'>
                        Please make sure you enter in your weight in kilograms
                      </span> -->
                    </div>
                  </div>

                  <div class="form-group col-md-4">
                    <label for="protein">Protein</label>
                    <div class="input-group">
                      <input type="number" step=any name="protein" id="protein" [(ngModel)]="this.remainingNutrients.proteinRemaining" [value]="this.remainingNutrients.proteinRemaining" class="form-control" ngModel #protein='ngModel' minlength='1' required [readonly]=useRecommended>
                      <!-- <span class="help-block" *ngIf='(!modelKilograms.valid || modelKilograms.value.length === 0) && modelKilograms.touched'>
                        Please make sure you enter in your weight in kilograms
                      </span> -->
                    </div>
                  </div>

                  <div class="form-group col-md-4">
                    <br/>
                    <div class="form-check">
                      <label class="form-check-label">
                        <input class="form-check-input" type="checkbox" value="" checked="" (click)='useRecommended = !useRecommended; printUseRecommended()'>
                        Use recommended nutrients
                        <span class="form-check-sign">
                          <span class="check"></span>
                        </span>
                      </label>
                    </div>
                  </div>

                </div>

              </div>

              <button type="button" class="btn btn-primary pull-right" (click)='searchForRecipes()'>Search</button>
              <span class="help-block" *ngIf='searchFormError'>Please make sure you have entered a value for all the boxes above before searching</span>

            </form>

            <mat-progress-spinner class="text-center" mode="indeterminate" *ngIf="recipeResultsReturned === 0"></mat-progress-spinner>

            <div id="results" style="margin-top: 75px" *ngIf="recipeResultsReturned === 1">
              <hr>
              <h4>Results</h4>

              <div class="card" *ngFor="let result of recipeSearchResults[pageNumber-1]; let j = index;">

                <div class="card-body">
                  <h6 class="card-title">
                    {{result.name}}
                  </h6>
                </div>

                <div class="card-footer">
                  Calories: {{result.calories}} | Carbs: {{result.carbs}} | Protein: {{result.protein}} | Fat: {{result.fat}} <br/>
                  <a (click)='addRecipeFromSearch(pageNumber-1, j)'>Add</a>
                </div>

              </div>

              <nav aria-label="...">
                <ul class="pagination justify-content-center">

                  <!-- Only show when pageNumber is not equal to 1 -->
                  <li class="page-item" *ngIf='pageNumber !== 1'>
                    <a class="page-link" (click)='pageNumber = pageNumber - 1'>Previous</a>
                  </li>

                  <!-- Only show when pageNumber is equal to maxPage number i.e. when you're on the last page
                       Don't show when there's maxPage number is greater than two otherwise we'll be showing -1 and 0 for when maxPage is 1 and 2 respectively-->
                  <li class="page-item" *ngIf='pageNumber === maxPage && maxPage > 2'>
                    <a class="page-link" (click)='pageNumber = pageNumber - 2'>
                      {{pageNumber - 2}}
                    </a>
                  </li>

                  <!-- Don't show page number if pageNumber is 1 -->
                  <li class="page-item" *ngIf='pageNumber !== 1'>
                    <a class="page-link" (click)='pageNumber = pageNumber - 1'>{{pageNumber - 1}}</a>
                  </li>

                  <!-- Current pageNumber -->
                  <li class="page-item active">
                    <span class="page-link">
                      {{pageNumber}}
                      <span class="sr-only">(current)</span>
                    </span>
                  </li>

                  <!-- Don't show if pageNumber is equal to the maxPage -->
                  <li class="page-item" *ngIf='pageNumber !== maxPage'>
                    <a class="page-link" (click)='pageNumber = pageNumber + 1'>
                      {{pageNumber + 1}}
                    </a>
                  </li>

                  <!-- Only show when pageNumber is equal to one i.e. when you're on the first page
                       Don't show when there's maxPage number is greater than two otherwise we'll be showing pages with no results-->
                  <li class="page-item" *ngIf='pageNumber === 1 && maxPage > 2'>
                    <a class="page-link" (click)='pageNumber = pageNumber + 2'>
                      {{pageNumber + 2}}
                    </a>
                  </li>

                  <!-- Only show when pageNumber is not equal to maxPage number -->
                  <li class="page-item" *ngIf="pageNumber !== maxPage">
                    <a class="page-link" (click)='pageNumber = pageNumber + 1'>Next</a>
                  </li>

                </ul>
              </nav>

            </div>

          </ng-container>

          <ng-container *ngIf="addRecipeOption === 1">

            <form #searchForFoodsForm='ngForm' ngNativeValidate>

              <div class="row">

                <div class="col-12">

                  <div class="form-group">

                    <div class="input-group">

                      <div class="input-group-prepend" style='padding-right:10px;'>

                        <select name="recipeType" id="recipeType" class="browser-default custom-select mb-3" [(ngModel)]="selectedRecipeType">
                          <option *ngFor="let type of recipeTypes" [ngValue]="type">{{type}}</option>
                        </select>

                      </div>

                      <input type="text" name="food" id="food" placeholder="Food" class="form-control" ngModel #food="ngModel" required>

                    </div>

                  </div>

                </div>

              </div>

              <button class="btn btn-primary pull-right" (click)="searchForFoods()">Search</button>

            </form>

            <mat-progress-spinner class="text-center" mode="indeterminate" *ngIf="foodResultsReturned === 0"></mat-progress-spinner>

            <div id="resultsFood" style="margin-top: 75px" *ngIf="foodResultsReturned === 1">

              <hr>
              <h4>Results</h4>

              <div class="card" *ngFor="let result of foodSearchResults[foodPageNumber-1]; let j = index;">

                <div class="card-body">
                  <h6 class="card-title">
                    {{result.name}}
                  </h6>
                </div>

                <div class="card-footer">

                  <div class="row">

                    <div class="col-3">

                      <img src="{{result.image}}" height=100 width=100 />

                    </div>

                    <div class="col-9">

                      <div id="addFood" style="padding-left: 10px">

                        <p>Calories: {{ result.calories }} | Carbs: {{ result.carbs }}g | Fat: {{ result.fat }}g | Protein: {{ result.protein }}g</p>

                        <div class="mb-3"></div>

                        <button rel="tooltip" class="btn btn-default btn-round pull-right" data-toggle="modal" data-target="#selectFood" (click)="selectFood(pageNumber-1, j)">
                          Set quantity
                          <!-- <i class="material-icons">add</i> -->
                        </button>

                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </ng-container>

          <!-- <ng-container *ngIf="addRecipeOption === 2">

            <form #addCustomRecipeForm='ngForm' ngNativeValidate>

              <div class="row">

                <div class="col-12">

                  <div class="form-group">
                    <label for="name">Recipe name</label>
                    <div class="input-group">
                      <input type="text" class="form-control" required>
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="name">Ingredients (separate with comma)</label>
                    <div class="input-group">
                      <input type="text" class="form-control" required>
                    </div>
                  </div>

                </div>

              </div>

            </form>

          </ng-container> -->


          <ng-container *ngIf="addRecipeOption === 3">
            Add from favourite recipes
          </ng-container>

        </ng-container>
      </div>

    </div>
  </div>
</div>

<div class="modal fade" id="selectFood" tabindex="-1" role="dialog" aria-labelledby="selectFood" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">

        <button type="button" class="btn btn-default btn-round" (click)="switchBackToMainModal()" data-toggle="modal" data-target="#exampleModal">
          <i class="material-icons">keyboard_arrow_left</i>Back
        </button>

        <button #closeAddFoodModal type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        {{ selectedFood.name }}

      </div>
      <div class="modal-footer">
        <div class="row">

          <div class="col-5">

            <img src="{{selectedFood.image}}" height=175 width=175 />

          </div>

          <div class="col-7">

            <div id="addFood" style="padding-left: 10px">

              <div id="beforeNutrientsFound" *ngIf="nutrientsReturned === -1">

                <h4>Per 100 Grams</h4>

                <p>
                  Calories: {{ selectedFood.calories }} <br/>
                  Carbs: {{ selectedFood.carbs }}g <br/>
                  Fat: {{ selectedFood.fat }}g <br/>
                  Protein: {{ selectedFood.protein }}g
                </p>

              </div>

              <mat-progress-spinner class="text-center" mode="indeterminate" *ngIf="nutrientsReturned === 0"></mat-progress-spinner>

              <div id="afterNutrientsFound" *ngIf="nutrientsReturned === 1">

                <h4>Per {{ measureForm.value.quantity }} {{ this.selectedMeasureType }}s</h4>

                <p>
                  Calories: {{ selectedFood.calories }} <br/>
                  Carbs: {{ selectedFood.carbs }}g <br/>
                  Fat: {{ selectedFood.fat }}g <br/>
                  Protein: {{ selectedFood.protein }}g
                </p>

              </div>

              <form #measureForm='ngForm'>

                <div class="form-group">

                  <div class="input-group">

                    <div class="input-group-prepend" style='padding-right:10px;'>

                      <select name="measureType" id="measureType" class="browser-default custom-select mb-3" (click)="updateFoodNutrients(measureForm)" [(ngModel)]="selectedMeasureType">
                        <option (click)="updateFoodNutrients(measureForm)" *ngFor="let type of selectedFood.measures" [ngValue]="type.label">{{type.label}}</option>
                      </select>

                    </div>

                    <input type="number" name="quantity" placeholder="Quantity" class="form-control" ngModel #quantity="ngModel" required (blur)="updateFoodNutrients(measureForm)">

                  </div>

                </div>

              </form>

              <div class="mb-3"></div>

              <button rel="tooltip" class="btn btn-success btn-round pull-right" data-toggle="modal" data-target="#selectFood" (click)="addFood()">
                <i class="material-icons">add</i> Add to plan
              </button>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
